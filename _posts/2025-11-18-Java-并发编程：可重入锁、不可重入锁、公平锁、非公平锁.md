---
title: å¹¶å‘ç¼–ç¨‹ï¼šå¯é‡å…¥é”ã€ä¸å¯é‡å…¥é”ã€å…¬å¹³é”ã€éå…¬å¹³é”
author: nhsoft.lsd
date: 2025-11-18
categories: [Java,å¹¶å‘ç¼–ç¨‹]
pin: false
---

# å¹¶å‘ç¼–ç¨‹ï¼šå¯é‡å…¥é”ã€ä¸å¯é‡å…¥é”ã€å…¬å¹³é”ã€éå…¬å¹³é”

---

## ä¸€ã€å¯é‡å…¥é”ï¼ˆReentrant Lockï¼‰

### æ¦‚å¿µ

**åŒä¸€ä¸ªçº¿ç¨‹**åœ¨**å¤–å±‚æ–¹æ³•è·å–é”ä¹‹å**ï¼Œåœ¨è¿›å…¥è¯¥é”ä¿æŠ¤çš„**å†…å±‚æ–¹æ³•æ—¶ï¼Œå¯ä»¥å†æ¬¡è·å¾—é”**ï¼Œä¸ä¼šè¢«è‡ªå·±é˜»å¡ã€‚

### ç‰¹ç‚¹ï¼š

* é”ç»´æŠ¤ä¸€ä¸ªæŒæœ‰çº¿ç¨‹çš„å¼•ç”¨å’Œ**é‡å…¥è®¡æ•°å™¨**
* æ¯ `lock()` ä¸€æ¬¡ï¼Œè®¡æ•° +1ï¼Œ`unlock()` ä¸€æ¬¡ï¼Œè®¡æ•° -1

### Java ç¤ºä¾‹

```java
public class ReentrantExample {
    private final ReentrantLock lock = new ReentrantLock();

    public void outer() {
        lock.lock();
        try {
            System.out.println("Entered outer");
            inner(); // å¯é‡å…¥ï¼šè¿™é‡Œä¸ä¼šæ­»é”
        } finally {
            lock.unlock();
        }
    }

    public void inner() {
        lock.lock(); // åŒä¸€çº¿ç¨‹å†æ¬¡è·å¾—é”
        try {
            System.out.println("Entered inner");
        } finally {
            lock.unlock();
        }
    }

    public static void main(String[] args) {
        new ReentrantExample().outer();
    }
}
```

### æœ¬è´¨ï¼š

JDK æä¾›çš„ `synchronized` å’Œ `ReentrantLock` é»˜è®¤å°±æ˜¯**å¯é‡å…¥é”**ã€‚

---

## äºŒã€ä¸å¯é‡å…¥é”ï¼ˆNon-Reentrant Lockï¼‰

### æ¦‚å¿µ

ä¸€ä¸ªçº¿ç¨‹**å†æ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰çš„é”æ—¶ä¼šè¢«é˜»å¡**ï¼Œå®¹æ˜“å¯¼è‡´**æ­»é”**ã€‚

### ç¤ºä¾‹ï¼ˆè‡ªå®šä¹‰ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼‰ï¼š

```java
public class NonReentrantLock {
    private boolean isLocked = false;
    private Thread lockedBy = null;

    public synchronized void lock() throws InterruptedException {
        while (isLocked) {
            wait();
        }
        isLocked = true;
        lockedBy = Thread.currentThread();
    }

    public synchronized void unlock() {
        if (Thread.currentThread() == lockedBy) {
            isLocked = false;
            lockedBy = null;
            notify();
        }
    }
}
```

### é£é™©ï¼š

```java
public class Test {
    private final NonReentrantLock lock = new NonReentrantLock();

    public void methodA() throws InterruptedException {
        lock.lock();
        System.out.println("methodA");
        methodB(); // æ­»é”ï¼šåŒçº¿ç¨‹å†æ¬¡åŠ é”ä¼šé˜»å¡
        lock.unlock();
    }

    public void methodB() throws InterruptedException {
        lock.lock(); // è¢«é˜»å¡
        System.out.println("methodB");
        lock.unlock();
    }
}
```

---

## ä¸‰ã€å…¬å¹³é”ï¼ˆFair Lockï¼‰

### æ¦‚å¿µ

**çº¿ç¨‹è·å–é”çš„é¡ºåº**ä¸å®ƒä»¬è¯·æ±‚é”çš„é¡ºåºä¸€è‡´ï¼Œ**å…ˆæ¥å…ˆå¾—**ã€‚

### ğŸ” Java å®ç°

```java
ReentrantLock lock = new ReentrantLock(true); // å…¬å¹³é”
```
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/68707c46d3464bfdbe3bb69ad966c93b.png)

### ç‰¹ç‚¹

* æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ä¼šæ’é˜Ÿ
* æ¯ä¸ªçº¿ç¨‹è½®åˆ°æ—¶æ‰èƒ½æ‹¿åˆ°é”
* é¿å…**çº¿ç¨‹é¥¥é¥¿**

---

## å››ã€éå…¬å¹³é”ï¼ˆNon-Fair Lockï¼‰

### æ¦‚å¿µ

çº¿ç¨‹åœ¨è¯·æ±‚é”æ—¶ï¼Œ**å¯ä»¥æ’é˜Ÿ**ï¼Œå¦‚æœé”ç©ºé—²å°±ç«‹å³è·å–ï¼Œä¸ç®¡æœ‰æ²¡æœ‰å…¶ä»–ç­‰å¾…çº¿ç¨‹ã€‚

### ğŸ” Java å®ç°

```java
ReentrantLock lock = new ReentrantLock(false); // éå…¬å¹³é”ï¼Œé»˜è®¤
```
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://i-blog.csdnimg.cn/direct/318e039e8f92437aabd4f3db1205b6bc.png)

### ç‰¹ç‚¹

* æ€§èƒ½é«˜ï¼Œ**ååé‡å¤§**
* å¯èƒ½å‡ºç°**é¥¥é¥¿ç°è±¡**
* å‡å°‘çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢

---

## äº”ã€æ€»ç»“

| åˆ†ç±»     | å¯é‡å…¥é”                            | ä¸å¯é‡å…¥é”          |
| ------ | ------------------------------- | -------------- |
| å®šä¹‰     | åŒä¸€çº¿ç¨‹å¯ä»¥é‡å¤è·å–å·²æŒæœ‰çš„é”                 | åŒä¸€çº¿ç¨‹é‡å¤è·å–é”ä¼šé˜»å¡è‡ªå·± |
| ä¾‹å­     | `synchronized`, `ReentrantLock` | è‡ªå®šä¹‰é”æˆ–æç®€å®ç°      |
| æ˜¯å¦é˜»å¡è‡ªèº« | å¦                               | æ˜¯              |
| æ­»é”é£é™©   | å°                               | å¤§              |

| åˆ†ç±»   | å…¬å¹³é”                   | éå…¬å¹³é”                   |
| ---- | --------------------- | ---------------------- |
| åŠ é”é¡ºåº | å…ˆè¿›å…ˆå‡º                  | æ’é˜Ÿï¼Œè°æŠ¢åˆ°è°æ‰§è¡Œ              |
| å®ç°æ–¹å¼ | `ReentrantLock(true)` | `ReentrantLock(false)` |
| æ€§èƒ½   | è¾ƒä½ï¼Œé¿å…é¥¥é¥¿               | è¾ƒé«˜ï¼Œä½†å¯èƒ½é€ æˆé¥¥é¥¿             |
| ä½¿ç”¨åœºæ™¯ | ä»»åŠ¡è°ƒåº¦æ•æ„Ÿã€å…¬å¹³æ€§é‡è¦          | æ€§èƒ½ä¼˜å…ˆï¼Œé”ç«äº‰æ¿€çƒˆ             |

---

## å…­ã€å»ºè®®ä½¿ç”¨æ–¹å¼

| åœºæ™¯              | å»ºè®®ä½¿ç”¨é”ç±»å‹    |
| --------------- | ---------- |
| æ–¹æ³•åµŒå¥—ã€è‡ªè°ƒç”¨        | å¯é‡å…¥é”ï¼ˆé»˜è®¤å³å¯ï¼‰ |
| é”ç«äº‰ä¸æ¿€çƒˆã€æ€§èƒ½ä¼˜å…ˆ     | éå…¬å¹³é”ï¼ˆé»˜è®¤ï¼‰   |
| å¯¹å»¶è¿Ÿå’Œå…¬å¹³æ€§è¦æ±‚é«˜ï¼ˆå¦‚é™æµï¼‰ | å…¬å¹³é”        |
| è‡ªå®šä¹‰é”ç±»           | è°¨æ…ï¼Œéœ€è€ƒè™‘å¯é‡å…¥æ€§ |

![weixin.png](/assets/img/nhsoft_lsd/weixin.png)

<div style="text-align: center;">å…¬ä¼—å·åç§°ï¼šæ€ªå‘³Coding</div>
<div style="text-align: center;">å¾®ä¿¡æ‰«ç å…³æ³¨æˆ–æœç´¢å…¬ä¼—å·åç§°</div>
